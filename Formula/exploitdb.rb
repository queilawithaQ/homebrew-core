class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2021-12-02",
      revision: "1abdd813008d9d595d95d61617effdccd42452f1"
  version "2021-12-02"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git", branch: "master"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_monterey: "e67cbb85df406f6d153a002af4c1bc6cbb9ce5a2dfee713a2acfadcfbc75a4f5"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "8aa1440d4bed3b516244ca4c0a1797c7d78e7214644c2ca0db12e264ad046ca9"
    sha256 cellar: :any_skip_relocation, monterey:       "0684b3ff8af90979eed39f63ab91f78917bef7533503cdd5d7823491a29a116d"
    sha256 cellar: :any_skip_relocation, big_sur:        "3299d5ef5dcd213beca3f882c7178101d6e12646868387528d743fb574c5d6bd"
    sha256 cellar: :any_skip_relocation, catalina:       "1c486e2d569703b71c375adb23bba042329b110e88d6a48bd2d94869261d4923"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "d3418e3dfe9709d8275132bf5c078f39da2facc6129c19b77c79a94d8de34eb5"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
